<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="item-element.html">
<dom-module id="host-element2">
  <template>
    <content></content>
  </template>
</dom-module>

<script>

  Polymer({

    is: 'host-element2',

    properties: {
      items: {
        type: Array,
        notify: true,
        value: function () {
          return [];
        }
      },

      itemsCopy: {
        type: Array,
        notify: true,
        value: function () {
          return [];
        }
      }

    },

    observers: [
        "_itemsChanged(items.splices)",
        "_itemsChangedDeep(items.*)"
    ],

    listeners: {
      'item-element-register': "_registerItemElement",
      'item-element-changed': "_itemElementChanged"
    },

    _itemsChanged: function(){
      console.log("_itemsChanged", arguments);
    },

    _itemsChangedDeep: function(){
      console.log("_itemsChangedDeep", arguments);
    },

    _registerItemElement: function(event){
      var itemElement = event.target;
      this.push("items", itemElement);
      this.push("itemsCopy", this._getItemObjectForItemElement(itemElement));
    },

    _itemElementChanged: function(event){
      var itemElement = event.target;
      var index = this._getIndexForItemElement(this.itemsCopy, itemElement);
      if (index != -1 ){
        // replacing old with new copy
        this.splice("itemsCopy", index, 1, this._getItemObjectForItemElement(itemElement));
      }
    },

    _getIndexForItemElement: function(arr, item){
      // assuming itemId is unique
      for (var i = 0; i < arr.length; i++){
        if (arr[i].itemId === item.itemId){
          return i;
        }
      }
      return -1;
    },

    _getItemObjectForItemElement: function(itemElement){
      return {'itemId': itemElement.itemId, 'values': itemElement.values, element: itemElement};
    }





  });

</script>